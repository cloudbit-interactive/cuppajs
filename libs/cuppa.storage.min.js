//! v0.0.6
export class CuppaStorage{static LOCAL="LOCAL";static SESSION="SESSION";static COOKIE="COOKIE";static INDEXED_DB="INDEXED_DB";static db;static data={};static callbacks={};static async setData({name:e="default",data:t=null,store:a="",silence:o=!1}){"function"==typeof a?a({name:e,data:t,silence:o,type:"set"}):String(a).toUpperCase()===CuppaStorage.LOCAL?localStorage.setItem(e,JSON.stringify(t)):String(a).toUpperCase()===CuppaStorage.SESSION?sessionStorage.setItem(e,JSON.stringify(t)):String(a).toUpperCase()===CuppaStorage.INDEXED_DB?await CuppaStorage.db.add(e,t):String(a).toUpperCase()===CuppaStorage.COOKIE?CuppaStorage.setCookie(e,JSON.stringify(t)):CuppaStorage.data[e]=t,o||CuppaStorage.executeCallbacks({name:e,data:t})}static setDataSync({name:e="default",data:t=null,store:a="",silence:o=!1}){"function"==typeof a?a({name:e,data:t,silence:o,type:"setSync"}):String(a).toUpperCase()===CuppaStorage.LOCAL?localStorage.setItem(e,JSON.stringify(t)):String(a).toUpperCase()===CuppaStorage.SESSION?sessionStorage.setItem(e,JSON.stringify(t)):String(a).toUpperCase()===CuppaStorage.COOKIE?CuppaStorage.setCookie(e,JSON.stringify(t)):CuppaStorage.data[e]=t,o||CuppaStorage.executeCallbacks({name:e,data:t})}static async getData({name:e="default",callback:t=null,store:a="",defaultValue:o=null}){let r;if("function"==typeof a)r=await a({name:e,callback:t,defaultValue:o,type:"get"});else if(String(a).toUpperCase()===CuppaStorage.LOCAL){let t=localStorage.getItem(e);if(t)try{r=JSON.parse(t)}catch(e){r=void 0}}else if(String(a).toUpperCase()===CuppaStorage.SESSION){let t=sessionStorage.getItem(e);if(t)try{r=JSON.parse(t)}catch(e){r=void 0}}else if(String(a).toUpperCase()===CuppaStorage.INDEXED_DB)r=await CuppaStorage.db.get(e);else if(String(a).toUpperCase()===CuppaStorage.COOKIE){let t=CuppaStorage.getCookie(e);if(t)try{r=JSON.parse(t)}catch(e){r=void 0}}else r=CuppaStorage.data[e];return void 0===r&&(r=o),null!=r&&t&&t(r),t&&CuppaStorage.addCallback({name:e,callback:t}),r}static getDataSync({name:e="default",callback:t=null,store:a="",defaultValue:o=null}){let r;if("function"==typeof a)r=a({name:e,callback:t,defaultValue:o,type:"getSync"});else if(String(a).toUpperCase()===CuppaStorage.LOCAL){let t=localStorage.getItem(e);t&&(r=JSON.parse(t))}else if(String(a).toUpperCase()===CuppaStorage.SESSION){let t=sessionStorage.getItem(e);t&&(r=JSON.parse(t))}else if(String(a).toUpperCase()===CuppaStorage.COOKIE){let t=CuppaStorage.getCookie(e);if(t)try{r=JSON.parse(t)}catch(e){r=void 0}}else r=CuppaStorage.data[e];return void 0===r&&(r=o),null!=r&&t&&t(r),t&&CuppaStorage.addCallback({name:e,callback:t}),r}static removeCallback({name:e,callback:t,likeString:a=!1}){if(!CuppaStorage.callbacks[e])return;let o=CuppaStorage.callbacks[e];for(let e=0;e<o.length;e++)a?o[e].toString()===t.toString()&&o.splice(e,1):o[e]===t&&o.splice(e,1)}static removeAllCallbacks({name:e}){delete CuppaStorage.callbacks[e]}static executeCallbacks({name:e,data:t}){if(!CuppaStorage.callbacks[e])return;let a=CuppaStorage.callbacks[e];for(let e=0;e<a.length;e++)a[e](t)}static addCallback=function({name:e,callback:t}){CuppaStorage.callbacks[e]||(CuppaStorage.callbacks[e]=[]),CuppaStorage.callbacks[e].push(t)}}document.defaultView.CuppaStorage||(document.defaultView.CuppaStorage=CuppaStorage);export class GetStorage extends HTMLElement{name;store;defaultValue;data;constructor(){super(),bindAll(this),this.style.display="none"}connectedCallback(){setTimeout((()=>{this.name=this.getAttribute("name"),this.store=this.getAttribute("store"),this.defaultValue=this.getAttribute("default-value"),CuppaStorage.getData({name:this.name,callback:this.onUpdateStorage,defaultValue:this.defaultValue,store:this.store}).then()}),0)}onUpdateStorage(e){this.data=e,this.dispatchEvent(new CustomEvent("change",{detail:this.data}))}disconnectedCallback(){CuppaStorage.removeCallback({name:this.name,callback:this.onUpdateStorage})}}document.defaultView.GetStorage||(customElements.define("get-storage",GetStorage),document.defaultView.GetStorage=GetStorage);class CuppaStorageInnoDB{config={db:"cuppa_db",storage:"cuppa_storage",version:1,update:!1};db;constructor(e){this.config={...this.config,...e},bindAll(this)}async connect(){let e=this.config;if(indexedDB.databases){let t=await indexedDB.databases();t=t.filter((t=>t.name==e.db))[0],e.version=t&&e.update?t.version+1:t?t.version:e.version}else e.version=e.version;const t=indexedDB.open(e.db,e.version);return t.onupgradeneeded=this.onUpdateDB,await new Promise((e=>{t.onsuccess=t=>{this.db=t.target.result,e(this)}}))}async onUpdateDB(e){this.db=e.target.result;let{db:t,config:a}=this;t.objectStoreNames.contains(a.storage)||t.createObjectStore(a.storage,{keyPath:"name"})}async add(e,t,a){this.db||await this.connect();let{db:o,config:r}=this,s=o.transaction(r.storage,"readwrite").objectStore(r.storage),n={name:e,value:t};return await new Promise((e=>{let t=s.put(n);t.onsuccess=()=>{e(t.result)},t.onerror=t=>{e(null,t.target.error)}})),await this.get(e,a)}async get(e,t){null==t&&(t=!0),this.db||await this.connect();let{db:a,config:o}=this,r=a.transaction(o.storage,"readwrite").objectStore(o.storage);return await new Promise((a=>{let o=r.get(e);o.onsuccess=()=>{a(t&&o.result?o.result.value:o.result)},o.onerror=e=>{a(null)}}))}async delete(e){this.db||await this.connect();let{db:t,config:a}=this;t.transaction(a.storage,"readwrite").objectStore(a.storage).delete(e)}}function bindAll(e,t){let a=Object.getOwnPropertyNames(Object.getPrototypeOf(e));t&&(a=Object.keys(e));for(let t=0;t<a.length;t++)"function"==typeof e[a[t]]&&(e[a[t]]=e[a[t]].bind(e))}CuppaStorage.db=new CuppaStorageInnoDB,CuppaStorage.setCookie=function(e,t="",a){if(a){let o=new Date;o.setDate(o.getDate()+a),t=encodeURIComponent(t)+"; expires="+o.toUTCString(),document.cookie=e+"="+t+";path=/; SameSite=Strict;"}else document.cookie=e+"="+t+";path=/; SameSite=Strict;"},CuppaStorage.getCookie=function(e,t){null==t&&(t=document);let a=t.cookie.match("(^|;) ?"+e+"=([^;]*)(;|$)");return a?decodeURIComponent(a[2]):null},CuppaStorage.deleteCookie=function(e){document.cookie=e+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;"};