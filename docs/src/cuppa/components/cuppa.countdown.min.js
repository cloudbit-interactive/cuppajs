export class CuppaComponent extends HTMLElement{cuppa=null;cuppaStorage=null;pure=!1;shadow=!1;state={};refs={};updatedCallback=null;autoAddChilds=!0;autoDefineObservables=!0;_getStorageDictionary={};_parser=new DOMParser;constructor(){super(),this.binAll=this.binAll.bind(this),this.connectedCallback=this.connectedCallback.bind(this),this.setState=this.setState.bind(this),this.forceRender=this.forceRender.bind(this),this.draw=this.draw.bind(this),this.createRealNode=this.createRealNode.bind(this),this.setAttributes=this.setAttributes.bind(this),this.setData=this.setData.bind(this),this.setStorage=this.setStorage.bind(this),this.getData=this.getData.bind(this),this.getStorage=this.getStorage.bind(this),this.removeStorage=this.removeStorage.bind(this),this.destroy=this.destroy.bind(this),this.disconnectedCallback=this.disconnectedCallback.bind(this),this.processRefs=this.processRefs.bind(this),this.autoSetObservables=this.autoSetObservables.bind(this),this.observables=this.observables.bind(this),this.binAll(this),this.autoSetObservables()}connectedCallback(){setTimeout((()=>{!0===this.shadow&&(this.shadow="open"),this.shadow&&this.attachShadow({mode:this.shadow}),this.forceRender(),this.connected&&this.connected(this)}),0)}setState(e,t){let s={...this.state,...e};JSON.stringify(s)!=JSON.stringify(this.state)&&(this.state=s,this.forceRender(t))}forceRender(e){if(this.pure)this.shadow?this.shadowRoot.innerHTML="shadow not supported in pure component":(this.innerHTML="",this.insertAdjacentHTML("afterbegin",this.render()));else{let e=this.render();this.autoAddChilds&&this.childs&&(e+=this.childs),e=e.trim(),e=e.replace(/\s+/gi," "),e=e.replace(/<!--(.*?)-->/g,""),e=e.replace(new RegExp("> <","g"),"><");let t=[...this._parser.parseFromString(e,"text/html").head.childNodes,...this._parser.parseFromString(e,"text/html").body.childNodes];this.shadow?(this.shadowRoot.append(""),t.map((e=>this.draw(e,0,null,this)))):t.map(((e,t)=>this.draw(e,t,null,this)))}this.processRefs(this,this.refs,"ref"),e&&e(),this.rendered&&this.rendered(this)}draw(e,t,s,n){let i=n.childNodes[t],o=e&&-1!=e.nodeName.indexOf("-");if(i){if(e&&i.nodeName.toUpperCase()==e.nodeName.toUpperCase()){if(3==e.nodeType&&i.nodeValue!=e.nodeValue)return void(i.nodeValue=e.nodeValue);if(1==e.nodeType){let t=i.getAttribute("key"),a=e.getAttribute("key");if(a&&t!=a)if(n.childNodes.length<s.childNodes.length){let t=this.createRealNode(e,o);i.insertAdjacentElement("beforebegin",t),i=t}else if(n.childNodes.length>s.childNodes.length){let e=i.nextSibling;n.removeChild(i),i=e}}}else if(e&&i.nodeName!=e.nodeName.toUpperCase()){if(3==e.nodeType)return void n.insertBefore(e,i);if(1==e.nodeType){let t=this.createRealNode(e,o);n.insertBefore(t,i),i=t}}}else{if(e&&3==e.nodeType)return void n.insertAdjacentText("beforeend",e.nodeValue);e&&(i=this.createRealNode(e,o),n.insertAdjacentElement("beforeend",i))}if(this.setAttributes(i,e),e&&o)return;let a=0,l=e?e.childNodes.length:0;for(;a<l;)this.draw(e.childNodes[a],a,e,i),a++;if(e)for(;i.childNodes.length>l;)i.removeChild(i.childNodes[e.childNodes.length])}createRealNode(e,t){let s=document.createElement(e.nodeName);return t&&(s.childs=e.innerHTML),s}setAttributes(element,newDomMap){if(element&&1==element.nodeType&&newDomMap&&null!=newDomMap.attributes){let i=0,length=newDomMap.attributes.length;for(;i<length;){let name=newDomMap.attributes[i].nodeName,value=newDomMap.attributes[i].nodeValue,oldValue=element.getAttribute(name);if("value"==name&&element.value)element.value=value;else if(value){if(oldValue!=value&&element[`__old_event_${name}`]!=value)if(0===name.indexOf("on")&&name.length>2){element[`__old_event_${name}`]=value;let eventName=name.replace("on","");if(-1!=value.indexOf("=>"))element.removeEventListener(eventName,eval(value)),element.addEventListener(eventName,eval(value));else{let e=value.replace("this.",""),t=e.indexOf("(");if(-1==t)element.removeEventListener(eventName,this[e]),element.addEventListener(eventName,this[e]);else{let s=e.slice(t+1,e.indexOf(")"));s=s.split(","),s=s.map((e=>e.trim())),e=e.slice(0,t),element.removeEventListener(eventName,(()=>this[e](...s))),element.addEventListener(eventName,(()=>this[e](...s)))}}}else element.setAttribute(name,value)}else element.removeAttribute(name);i++}}}setData(e,t){!this.cuppa&&this.cuppaStorage&&(this.cuppa=this.cuppaStorage),this.cuppa&&this.cuppa.setData(e,t)}setStorage(e,t){this.setData(e,t)}getData(e,t){if(!this.cuppa&&this.cuppaStorage&&(this.cuppa=this.cuppaStorage),this.cuppa)return t&&t.callback?(this.cuppa.getData(e,t),void(this._getStorageDictionary[e]=t)):this.cuppa.getData(e,t)}getStorage(e,t){return this.getData(e,t)}removeStorage(){!this.cuppa&&this.cuppaStorage&&(this.cuppa=this.cuppaStorage),this.cuppa&&Object.entries(this._getStorageDictionary).map((([e,t])=>{t&&t.callback&&this.cuppa.removeListener(e,t.callback),delete this._getStorageDictionary[e]}))}destroy(){this.removeStorage()}disconnectedCallback(){this.destroy&&this.destroy(),this.disconnected&&this.disconnected(this)}processRefs(e,t,s){s||(s="id");let n={},i=Array.from(e.querySelectorAll(`[${s}]`));for(let e=0;e<i.length;e++)t?t[i[e].getAttribute(s)]=i[e]:n[i[e].getAttribute(s)]=i[e];return t?t.rootHtml=e:n.rootHtml=e,n}binAll(e,t){let s=Object.getOwnPropertyNames(Object.getPrototypeOf(e));t&&(s=Object.keys(e));for(let t=0;t<s.length;t++)"function"==typeof e[s[t]]&&(e[s[t]]=e[s[t]].bind(e))}autoSetObservables(){let e={};Object.keys(this).map((t=>e[t]=1)),setTimeout((()=>{this.autoDefineObservables&&Object.keys(this).map((t=>{e[t]||this.observables({[t]:this[t]})}))}),0)}observables(e,t){let s,n=this;if(e)return Object.keys(e).map(((i,o)=>{o||(s=i);let a=e[i],l="_"+i;n[l]=a,Object.defineProperty(n,i,{set:e=>{n[l]=e,n.forceRender&&n.forceRender(),t&&t()},get:()=>n[l],configurable:!0})})),n[s]}}export default class CuppaCountDown extends CuppaComponent{countDown;time;type="default";callback;"show-days"=!0;"show-hours"=!0;"show-minutes"=!0;"show-seconds"=!0;"auto-remove"=!1;constructor(){super()}connected(){this.updateCountdown()}static get observedAttributes(){return["time","show-days","show-hours","show-minutes","show-seconds","type","auto-remove"]}attributeChangedCallback(e,t,s){this[e]=s,"time"==e&&this.updateCountdown()}updateCountdown(){if(this.countDown&&this.countDown.destroy(),!this.time)return;let e=this.time.length<=8?timeToDate(this.time):new Date(this.time);this.countDown=new countdown(e,(()=>{this.countDown&&this.forceRender()}),this.onComplete)}onComplete(){this.dispatchEvent(new Event("complete")),this.callback&&this.callback(this)}disconnected(){this.countDown&&this.countDown.destroy()}render(){return`\n            <style>\n                cuppa-countdown{ display: inline-flex; }\n                cuppa-countdown, cuppa-countdown *{ box-sizing: border-box; }\n                cuppa-countdown .box{ position:relative; margin:0 10px 0 0; border-radius: 5px; background: #29303D;  box-shadow: 0 3px 6px rgba(0,0,0,0.2); display: inline-flex; width: 46px; height: 46px; justify-content: center; align-items: center; }\n                cuppa-countdown .box:last-of-type{ margin:0; }\n                cuppa-countdown .overline{ display: block; width: 100%; position: absolute; height: 1px; background:#29303D; top:50%; }\n                cuppa-countdown .number{ color:#FFF; font-size: 31px; }\n                cuppa-countdown .text{ top:calc(100% + 5px); font-size: 11px; position: absolute; display: block; color:#444; font-weight: 700; }\n\n                cuppa-countdown .inline-box{ display:inline-flex; align-items:baseline; margin:0 15px 0 0; }\n                cuppa-countdown .inline-box:last-of-type{ margin:0;}\n                cuppa-countdown .inline-number{ font-size: 40px;}\n                cuppa-countdown .inline-text{ font-size:18px; }\n            </style>\n            <div class="${this.type}">\n                ${"inline"==this.type?`\n                    ${!boolean(this["show-days"])||boolean(this["auto-remove"])&&!val(this.countDown,"days")?"":`\n                        <div class="inline-box days">\n                            <span class="inline-number">${this.countDown?this.countDown.days:0}</span>\n                            <span class="inline-text">d</span>\n                        </div>\n                    `}\n    \n                    ${!boolean(this["show-hours"])||boolean(this["auto-remove"])&&!val(this.countDown,"hours")&&!val(this.countDown,"days")?"":`\n                        <div class="inline-box hours">\n                            <span class="inline-number">${this.countDown?this.countDown.hours:0}</span>\n                            <span class="inline-text">h</span>\n                        </div>\n                    `}\n    \n                    ${boolean(this["show-minutes"])&&(!boolean(this["auto-remove"])||val(this.countDown,"minutes")||val(this.countDown,"hours")||val(this.countDown,"days"))?`\n                        <div class="inline-box minutes">\n                            <span class="inline-number">${this.countDown?this.countDown.minutes:0}</span>\n                            <span class="inline-text">m</span>\n                        </div>\n                    `:""}\n    \n                    ${boolean(this["show-seconds"])&&(!boolean(this["auto-remove"])||val(this.countDown,"seconds")||val(this.countDown,"minutes")||val(this.countDown,"hours")||val(this.countDown,"days"))?`\n                        <div class="inline-box seconds">\n                            <span class="inline-number">${this.countDown?this.countDown.seconds:0}</span>\n                            <span class="inline-text">s</span>\n                        </div>\n                    `:""}\n                `:`\n                    ${!boolean(this["show-days"])||boolean(this["auto-remove"])&&!val(this.countDown,"days")?"":`\n                        <div class="box days" >\n                            <span class="number">${left0(this.countDown?this.countDown.days:0)}</span>\n                            <div class="overline"></div>\n                            <span class="text">Days</span>\n                        </div>\n                    `}\n                    \n                    ${!boolean(this["show-hours"])||boolean(this["auto-remove"])&&!val(this.countDown,"hours")&&!val(this.countDown,"days")?"":`\n                        <div class="box hours" >\n                            <span class="number">${left0(this.countDown?this.countDown.hours:0)}</span>\n                            <div class="overline"></div>\n                            <span class="text">Hours</span>\n                        </div>\n                    `}\n    \n                    ${boolean(this["show-minutes"])&&(!boolean(this["auto-remove"])||val(this.countDown,"minutes")||val(this.countDown,"hours")||val(this.countDown,"days"))?`\n                        <div class="box minutes" >\n                            <span class="number">${left0(this.countDown?this.countDown.minutes:0)}</span>\n                            <div class="overline"></div>\n                            <span class="text">Minutes</span>\n                        </div>\n                    `:""}\n    \n                    ${boolean(this["show-seconds"])&&(!boolean(this["auto-remove"])||val(this.countDown,"seconds")||val(this.countDown,"minutes")||val(this.countDown,"hours")||val(this.countDown,"days"))?`\n                        <div class="box seconds" >\n                            <span class="number">${left0(this.countDown?this.countDown.seconds:0)}</span>\n                            <div class="overline"></div>\n                            <span class="text">Seconds</span>\n                        </div>\n                    `:""}\n                `}\n            </div>\n            \n        `}}customElements.define("cuppa-countdown",CuppaCountDown);let left0=function(e){return e||(e=0),(e=parseFloat(e))<10&&(e="0"+e),e},countdown=function(e,t,s,n){this.days=0,this.hours=0,this.minutes=0,this.seconds=0,this.timeout=null,this.status="running",this.constructor=function(){bindAll(this,!0),null==n&&(n=1e3),this.update()},this.update=function(){let i=e.getTime()-(new Date).getTime();this.seconds=Math.floor(i/1e3),this.minutes=Math.floor(this.seconds/60),this.hours=Math.floor(this.minutes/60),this.days=Math.floor(this.hours/24),this.seconds%=60,this.minutes%=60,this.hours%=24,this.days<=0&&this.hours<=0&&this.minutes<=0&&this.seconds<=0?(this.days=0,this.hours=0,this.minutes=0,this.seconds=0,this.status="end",s&&s(this)):(this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(this.update,n)),t&&t(this)},this.destroy=function(){this.timeout&&clearTimeout(this.timeout)},this.constructor()},bindAll=function(e,t){let s=Object.getOwnPropertyNames(Object.getPrototypeOf(e));t&&(s=Object.keys(e));for(let t=0;t<s.length;t++)"function"==typeof e[s[t]]&&(e[s[t]]=e[s[t]].bind(e))},timeToDate=function(e){e||(e="00:00:00"),e=e.toUpperCase();let t=parseInt(e.substr(0,2));-1!=e.indexOf("AM")&&12==t&&(t=0),-1!=e.indexOf("PM")&&12!=t&&(t+=12);let s=parseInt(e.substr(3,2)),n=parseInt(e.substr(6,2)),i=new Date;return i.setHours(t),i.setMinutes(s),i.setSeconds(n),i},boolean=function(e){let t=e;return t="false"!==t&&!1!==t&&0!==t&&"0"!==t&&null!=t&&""!==t,t},val=function(e,t,s){if(!e)return s;if(e&&!t)return e;t=trim(t).split(".");let n=e;for(let e=0;e<t.length;e++)try{n=n[t[e]]}catch(e){n="";break}if(n){let e=JSON.stringify(n);"{}"!=e&&"[]"!=e&&null!=e&&null!=e||(n="")}return""!==n&&null!=n||null==s||(n=s),n},trim=function(e){return e?e.replace(/^\s+|\s+$/g,""):""};